# Epic 5 Retrospective - Cart Experience

**Date:** 2026-01-29  
**Epic:** Epic 5 - Cart Experience  
**Stories Completed:** 9 done, 1 in review (5-7 Remove Items from Cart)  
**Team:** Bob (Scrum Master), Alice (Product Owner), Amelia (Developer), Murat (Test Architect)  
**Facilitated by:** Bob (Scrum Master)  
**Project Lead:** Bubbles  

---

## Epic Summary

Epic 5 delivered the full B2C cart experience for Isla Suds: cart creation and persistence, add-to-cart (individual and variety pack), cart drawer (Radix Dialog), line items display, quantity updates, remove items, empty cart state, proceed to checkout, and cart icon in the sticky header. One story (5-7 Remove Items from Cart) is in **review** at retro time; all other stories are **done**.

**Functional Requirements Covered:** FR13, FR14, FR15, FR16, FR17, FR18, FR21, FR44 (8 FRs)  
**NFRs Addressed:** NFR5 (<200ms drawer), NFR15 (Storefront API), NFR20 (cart persistence), NFR24 (empty cart messaging)

**Stories Delivered:**

1. 5-1: Cart creation and persistence (session cookies, secure flags)
2. 5-2: Add individual product to cart
3. 5-3: Add variety pack bundle to cart
4. 5-4: Build cart drawer component (Radix Dialog)
5. 5-5: Display cart line items
6. 5-6: Modify cart quantities
7. 5-7: Remove items from cart *(in review)*
8. 5-8: Display empty cart state
9. 5-9: Proceed to checkout
10. 5-10: Cart icon in sticky header

---

## Partial Retrospective Note

Epic 5 retrospective was run with **9/10 stories done** and **5-7 in review**. Lessons and action items reflect the work completed; 5-7 completion may surface additional findings during code review.

---

## Key Patterns Discovered

### 1. Cart Context and Session as Foundation

**Stories:** 5-1, 5-2, 5-3

Hydrogen cart context (`app/lib/context.ts`) and custom `AppSession` (`app/lib/session.ts`) provided a single source of truth for cart ID persistence. Story 5-1 added production `secure: true` for session cookies and comprehensive tests (unit + E2E) for persistence and expired/invalid cart handling.

**Impact:** All later stories (add, drawer, line items, quantities, remove, checkout) relied on this foundation without rework.

### 2. Radix Dialog for Cart Drawer

**Stories:** 5-4, 5-5, 5-6, 5-7, 5-8

Cart drawer used Radix Dialog for accessibility (focus trap, Escape, backdrop close, aria). Same pattern as Epic 3 texture reveal and Epic 4 collection prompt—consistency across modals/drawers.

**Impact:** NFR5 (<200ms) and NFR8/NFR9/NFR11 satisfied with minimal custom code. Pattern is repeatable for future overlay UI.

### 3. Optimistic UI and Warm Error Messaging

**Stories:** 5-2, 5-3, 5-6, 5-7

Add-to-cart, quantity updates, and remove used optimistic updates with revert-on-failure. Error copy from `app/content/errors.ts` kept tone warm and non-accusatory (NFR22, NFR24).

**Impact:** Cart feels responsive; failures don’t undermine trust. Brand tone maintained in edge cases.

### 4. Zustand + Hydrogen Cart Boundary

**Stories:** 5-4, 5-10

Zustand `cartDrawerOpen` drove drawer visibility; cart data came from Hydrogen `useCart()`. Clear split: UI state in Zustand, cart data from server/cart context.

**Impact:** No duplicate cart state; drawer open/close and header badge stayed in sync with cart context.

### 5. Testing and Security Hardening

**Story:** 5-1

5-1 added 16+ tests (cart context init, session cookie security, persistence across close/reopen, invalid cart ID handling). Security fix: `secure: true` in production for session cookies.

**Impact:** Cart persistence and security are test-backed; regression risk reduced for Epic 6 checkout.

---

## What Went Well

1. **Foundation-first** – Cart creation and persistence (5-1) was done first and was stable; no refactors needed in later stories.
2. **Radix Dialog reuse** – Drawer (5-4) reused the same accessibility and interaction pattern as earlier epics; implementation was predictable.
3. **Consistent cart UX** – Add (5-2, 5-3), quantities (5-6), remove (5-7), empty state (5-8), and checkout (5-9) shared optimistic UI and error handling patterns.
4. **Header integration** – Cart icon and count in sticky header (5-10) connected cleanly to cart context and drawer state.
5. **Security and test coverage** – Session cookie security and comprehensive tests in 5-1 set a good baseline for checkout (Epic 6).

---

## Challenges and Growth Areas

1. **One story in review** – 5-7 (Remove items) was still in review at retro time. Final review may add minor follow-ups; no systemic risk observed.
2. **Epic 4 retro skipped** – No formal Epic 4 retrospective to compare against; continuity with Epic 3 retro only.
3. **Optional confirmation for remove** – 5-7 left screen-reader confirmation as optional; worth validating with real users or accessibility audit in Epic 9.

---

## Previous Retrospective Follow-Through

**Epic 4 retrospective:** Skipped (no prior retro to compare).  
**Epic 3 retrospective:** Lessons (performance contract, Radix reuse, test maturity) were consistent with Epic 5 approach; no new “we didn’t do what we said” items.

---

## Next Epic Preview: Epic 6 – Checkout & Communication

**Epic 6:** Checkout & Communication  
**Stories:** 7 (Shopify checkout, order confirmation email, payment retry, booth attribution, “How did you find us?” survey, Day 3 survey link, Contact page)

**Dependencies on Epic 5:**

- Cart drawer “Proceed to Checkout” (5-9) must hand off to Shopify checkout URL reliably.
- Cart persistence and session (5-1) must remain solid so returning users don’t lose carts before checkout.
- Empty cart and error messaging patterns should align with checkout error handling (NFR22).

**Preparation / Prerequisites:**

- Confirm Shopify checkout URL and branding/config in admin.
- Identify how booth attribution (6-4) and “How did you find us?” (6-5) are implemented (checkout customization vs app).
- Plan Contact page (6-7) placement and form/email mechanism.

---

## Action Items

| # | Action | Owner | Success Criteria |
|---|--------|--------|------------------|
| 1 | Complete code review for 5-7 (Remove items); address any findings and mark story done | Dev / SM | 5-7 status = done in sprint-status.yaml |
| 2 | Before starting Epic 6, confirm cart → checkout flow (5-9 → 6-1) on staging with real cart | Dev | No broken redirect or lost cart at handoff |
| 3 | Document Shopify checkout customization approach for 6-4, 6-5 (attribution + survey) | PM / Dev | Decision recorded for Epic 6 story creation |
| 4 | Optional: Revisit remove-item confirmation for screen readers in Epic 9 accessibility audit | Test / UX | Decision: keep optional vs add confirmation |

---

## Team Agreements

- **Cart = single source in Hydrogen** – No client-side cart duplication; Zustand only for UI (e.g. drawer open).
- **Optimistic UI + warm errors** – Keep pattern for any future cart-like mutations (e.g. Epic 7 wholesale).
- **Security and cookies** – Any new session/cookie usage must match 5-1 pattern (httpOnly, sameSite, secure in prod).

---

## Critical Path Before Epic 6

1. **5-7 done** – Close review and mark 5-7 done so Epic 5 is fully complete.
2. **Cart → checkout handoff verified** – Smoke test: add to cart → checkout from drawer; confirm URL and cart contents in Shopify checkout.
3. **Epic 6 story prep** – Create stories (e.g. via SM create-story) after above checks; no new blocking dependencies identified.

---

## Readiness Assessment

| Area | Status | Notes |
|------|--------|--------|
| **Testing & quality** | ✅ | 5-1 test suite strong; other stories covered by existing flows. 5-7 to be confirmed after review. |
| **Deployment** | Assumed OK | No explicit deployment callout; follows existing Oxygen/deploy process. |
| **Stakeholder acceptance** | Pending | Cart experience is demo-ready once 5-7 is done. |
| **Technical health** | ✅ | Cart context, session, and drawer patterns are clear and consistent. |
| **Unresolved blockers** | None | Only 5-7 review outstanding. |

---

## Key Takeaways

1. **Cart foundation (5-1) was the right first step** – Persistence and security done once and reused everywhere.
2. **Radix Dialog continues to pay off** – Cart drawer matched Epic 3/4 modal patterns and met NFR5 and accessibility.
3. **Optimistic UI + warm errors** – Kept cart feel responsive and aligned with brand; worth keeping for Epic 6/7.
4. **One story in review is acceptable** – Run retro with 9/10 done; close 5-7 and then treat Epic 5 as fully complete for Epic 6 planning.

---

## Retrospective Closure

**Commitments:** 4 action items; 3 team agreements; 3 critical path items (5-7 done, checkout handoff verified, Epic 6 story prep).

**Next steps:**

1. Complete 5-7 review and mark done.
2. Smoke-test cart → checkout handoff.
3. Run sprint-planning or create-story for Epic 6 when ready.
4. Use this retro in Epic 6 kickoff for continuity.

---

*Retrospective complete. Epic 5 status: 9 done, 1 in review. Epic-5-retrospective marked done in sprint-status.yaml after this document is saved.*
